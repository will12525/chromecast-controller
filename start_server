#!/bin/bash


TEST_ENV=$1
WORKSPACE=`pwd`
PORT=5000

# Check if .venv exists
if [ ! -d "${WORKSPACE}/.venv/" ]; then
    echo "Creating virtual environment ${WORKSPACE}/.venv"
    # Create virtual environment
    python3.9 -m venv $WORKSPACE/.venv
fi

# Source virtual environement
echo "Sourcing venv"
source $WORKSPACE/.venv/bin/activate
# Install requirements
echo "Installing requirments"
pip install -r $WORKSPACE/requirements.txt


# Check if using test environement
echo "Checking if test server"
if [ "$TEST_ENV" = "test" ]; then
  echo "USING PRODUCTION PORT"
  PORT=5001
fi

#Activate virtual env
#. $WORKSPACE/media_controller_python_venv/bin/activate

#python3 -m pip install -r $WORKSPACE/requirements.txt

# Point to the main flask applicaiton
echo "Setting flask app"
export FLASK_APP=$WORKSPACE/flask_main.py

# Start the flask server
echo "Starting flask app"
flask run --host=0.0.0.0 -p "$PORT"


